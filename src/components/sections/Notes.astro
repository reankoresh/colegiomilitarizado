---
import { ArrowLeft, ArrowRight } from "lucide-astro";
---

<div class="container mx-auto px-4 py-8 md:py-12">
  <!-- Layout: izquierda lista, derecha tarjetas -->
  <div class="grid grid-cols-1 md:grid-cols-[280px_1fr] gap-6">
    <!-- Lista lateral -->
    <div class="space-y-4 hidden md:block">
      <button
        class="note-tab w-full text-left rounded-2xl px-5 py-4 bg-stone-900 text-stone-50 shadow-sm flex items-center justify-between"
        data-index="0"
      >
        <span>
          <p class="text-sm font-medium">Audiobooks</p>
          <p class="text-xs text-stone-300">
            Create high-quality multi-character audiobooks...
          </p>
        </span>
        <span class="text-stone-300">›</span>
      </button>
      <button
        class="note-tab w-full text-left rounded-2xl px-5 py-4 bg-stone-100 text-stone-800 shadow-sm flex items-center justify-between"
        data-index="1"
      >
        <span>
          <p class="text-sm font-medium">Video voiceovers</p>
          <p class="text-xs text-stone-600">
            Choose the perfect voice for your video...
          </p>
        </span>
        <span class="text-stone-500">›</span>
      </button>
      <button
        class="note-tab w-full text-left rounded-2xl px-5 py-4 bg-stone-100 text-stone-800 shadow-sm flex items-center justify-between"
        data-index="2"
      >
        <span>
          <p class="text-sm font-medium">Podcasts</p>
          <p class="text-xs text-stone-600">
            Create multi-speaker podcasts that sound like real...
          </p>
        </span>
        <span class="text-stone-500">›</span>
      </button>
    </div>

    <!-- Escenario con tarjetas -->
    <div class="relative min-h-[500px] bg-orange-50 rounded-2xl">
      <!-- Tarjetas (apiladas) -->
      <div class="note-stage relative h-[460px] md:absolute md:inset-0">
        <div
          class="note-track flex md:block h-full overflow-x-auto md:overflow-visible gap-6 px-3"
          style="scroll-snap-type: x mandatory;"
        >
          <!-- Item 0: Encabezado arriba + Card (purple) -->
          <div
            class="note-item flex-none w-[380px]"
            style="scroll-snap-align: center;"
          >
            <div class="md:hidden mb-3">
              <p class="text-base font-semibold text-stone-800">Audiobooks</p>
              <p class="text-xs text-stone-500">
                Create high-quality multi-character audiobooks. Upload your PDF,
                select your characters, direct delivery and publish.
              </p>
            </div>
            <div
              class="note-card md:absolute md:top-1/2 md:left-1/2 h-[380px] w-[380px] rounded-2xl bg-[#dcd1ff] shadow-md p-6 transition-transform duration-500 ease-out"
              data-card="0"
            >
              <p class="text-lg md:text-xl font-medium text-stone-900 mb-6">
                'Twas the night before Christmas,
              </p>
              <p class="text-stone-800">
                when all through the house. Not a creature was stirring, not
                even a mouse...
              </p>
              <button
                class="mt-6 inline-flex items-center justify-center h-10 w-16 rounded-full bg-white shadow ring-1 ring-stone-200 text-stone-700"
                >▶</button
              >
            </div>
          </div>
          <!-- Item 1: Encabezado arriba + Card (pink) -->
          <div
            class="note-item flex-none w-[380px]"
            style="scroll-snap-align: center;"
          >
            <div class="md:hidden mb-3">
              <p class="text-base font-semibold text-stone-800">
                Video voiceovers
              </p>
              <p class="text-xs text-stone-500">
                Choose the perfect voice for your video or clone your own voice.
                Then generate high-quality voiceovers for ads, shorts, or
                feature-length films.
              </p>
            </div>
            <div
              class="note-card md:absolute md:top-1/2 md:left-1/2 h-[380px] w-[380px] rounded-2xl bg-[#f3d9f1] shadow-md p-6 transition-transform duration-500 ease-out"
              data-card="1"
            >
              <p class="text-lg md:text-xl font-medium text-stone-900 mb-6">
                I'm, like, stunned. It's totally insane to me...
              </p>
              <p class="text-stone-800">can't they just wait one day?</p>
              <button
                class="mt-6 inline-flex items-center justify-center h-10 w-16 rounded-full bg-white shadow ring-1 ring-stone-200 text-stone-700"
                >▶</button
              >
            </div>
          </div>
          <!-- Item 2: Encabezado arriba + Card (orange) -->
          <div
            class="note-item flex-none w-[380px]"
            style="scroll-snap-align: center;"
          >
            <div class="md:hidden mb-3">
              <p class="text-base font-semibold text-stone-800">Podcasts</p>
              <p class="text-xs text-stone-500">
                Create multi-speaker podcasts that sound like real, studio
                quality dialogue. Select your voices, generate audio, and
                download.
              </p>
            </div>
            <div
              class="note-card md:absolute md:top-1/2 md:left-1/2 h-[380px] w-[380px] rounded-2xl bg-[#f9d8aa] shadow-md p-6 transition-transform duration-500 ease-out"
              data-card="2"
            >
              <p class="text-lg md:text-xl font-medium text-stone-900 mb-6">
                So he, uh, he goes down this crazy rat hole...
              </p>
              <p class="text-stone-800">
                He's standing barefoot on the back of a llama...
              </p>
              <button
                class="mt-6 inline-flex items-center justify-center h-10 w-16 rounded-full bg-white shadow ring-1 ring-stone-200 text-stone-700"
                >▶</button
              >
            </div>
          </div>
        </div>
      </div>

      <!-- Controles -->
      <div
        class="absolute bottom-4 left-0 right-0 flex items-center justify-center gap-3"
      >
        <button
          class="note-prev inline-flex h-11 w-11 items-center justify-center rounded-full bg-white ring-1 ring-stone-300 shadow-sm hover:ring-stone-400"
          aria-label="Anterior"
        >
          <ArrowLeft class="h-4 w-4 text-stone-600" aria-hidden="true" />
        </button>
        <button
          class="note-next inline-flex h-11 w-11 items-center justify-center rounded-full bg-white ring-1 ring-stone-300 shadow-sm hover:ring-stone-400"
          aria-label="Siguiente"
        >
          <ArrowRight class="h-4 w-4 text-stone-600" aria-hidden="true" />
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  const tabs = Array.from(
    document.querySelectorAll(".note-tab")
  ) as HTMLElement[];
  const cards = Array.from(
    document.querySelectorAll(".note-card")
  ) as HTMLElement[];
  const prevBtn = document.querySelector(
    ".note-prev"
  ) as HTMLButtonElement | null;
  const nextBtn = document.querySelector(
    ".note-next"
  ) as HTMLButtonElement | null;
  let active = 0;

  const applyState = () => {
    const n = cards.length;
    const track = document.querySelector(".note-track") as HTMLElement | null;
    const isDesktop = () => window.matchMedia("(min-width: 768px)").matches;

    if (isDesktop()) {
      cards.forEach((card, i) => {
        const rel = (i - active + n) % n; // 0: center, 1: right, 2: left
        card.style.zIndex = (rel === 0 ? 30 : rel === 2 ? 20 : 10).toString();
        // posiciones: izquierda, centro, derecha
        if (rel === 0) {
          card.style.transform = "translate(-50%, -50%) translateX(0) scale(1)";
          card.style.opacity = "1";
        } else if (rel === 1) {
          card.style.transform =
            "translate(-50%, -50%) translateX(180px) scale(0.96)";
          card.style.opacity = "0.85";
        } else {
          card.style.transform =
            "translate(-50%, -50%) translateX(-180px) scale(0.96)";
          card.style.opacity = "0.85";
        }
      });
    } else {
      // móvil: slider por scroll
      cards.forEach((card) => {
        card.style.zIndex = "";
        card.style.transform = "none";
        card.style.opacity = "1";
      });
      if (track && cards[active]) {
        const target = cards[active] as HTMLElement;
        track.scrollTo({ left: target.offsetLeft - 8, behavior: "smooth" });
      }
    }
    tabs.forEach((t, i) => {
      if (i === active) {
        t.classList.remove("bg-stone-100", "text-stone-800");
        t.classList.add("bg-stone-900", "text-stone-50");
      } else {
        t.classList.remove("bg-stone-900", "text-stone-50");
        t.classList.add("bg-stone-100", "text-stone-800");
      }
    });
  };

  const setActive = (idx: number) => {
    active = (idx + cards.length) % cards.length;
    applyState();
  };

  tabs.forEach((tab) => {
    tab.addEventListener("click", () => {
      const idx = parseInt(tab.getAttribute("data-index") || "0", 10);
      setActive(idx);
    });
  });
  prevBtn?.addEventListener("click", () => setActive(active - 1));
  nextBtn?.addEventListener("click", () => setActive(active + 1));

  // estado inicial
  applyState();
  window.addEventListener("resize", applyState, { passive: true });
</script>
